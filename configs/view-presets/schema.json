{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://atlas-composer.com/schemas/view-preset.json",
  "title": "Atlas Composer View Mode Preset",
  "description": "JSON schema for view mode preset files (unified, split, composite-existing). Separate from composite-custom presets.",
  "type": "object",
  "required": ["id", "name", "atlasId", "viewMode", "config"],
  "properties": {
    "$schema": {
      "type": "string",
      "description": "JSON Schema reference"
    },
    "id": {
      "type": "string",
      "pattern": "^[a-z0-9]+(-[a-z0-9]+)*$",
      "description": "Unique preset identifier (kebab-case, e.g., 'france-unified-default')"
    },
    "name": {
      "type": "string",
      "minLength": 1,
      "description": "Human-readable preset name"
    },
    "description": {
      "type": "string",
      "description": "Optional preset description"
    },
    "atlasId": {
      "type": "string",
      "enum": ["france", "portugal", "eu", "usa", "world"],
      "description": "Target atlas ID"
    },
    "viewMode": {
      "type": "string",
      "enum": ["unified", "split", "composite-existing"],
      "description": "View mode this preset is for"
    },
    "config": {
      "description": "View mode-specific configuration",
      "oneOf": [
        {
          "description": "Unified view configuration",
          "$ref": "#/definitions/unifiedConfig"
        },
        {
          "description": "Split view configuration",
          "$ref": "#/definitions/splitConfig"
        },
        {
          "description": "Composite-existing view configuration",
          "$ref": "#/definitions/compositeExistingConfig"
        }
      ]
    }
  },
  "additionalProperties": false,
  "definitions": {
    "projectionParameters": {
      "type": "object",
      "description": "Projection parameters (rotate, center, parallels, etc.)",
      "properties": {
        "rotate": {
          "type": "array",
          "items": { "type": "number" },
          "minItems": 2,
          "maxItems": 3,
          "description": "Rotation [lambda, phi, gamma] in degrees"
        },
        "center": {
          "type": "array",
          "items": { "type": "number" },
          "minItems": 2,
          "maxItems": 2,
          "description": "Center [longitude, latitude] in degrees"
        },
        "parallels": {
          "type": "array",
          "items": { "type": "number" },
          "minItems": 2,
          "maxItems": 2,
          "description": "Standard parallels for conic projections"
        },
        "scale": {
          "type": "number",
          "minimum": 0,
          "description": "Projection scale multiplier"
        },
        "scaleMultiplier": {
          "type": "number",
          "minimum": 0,
          "description": "Scale multiplier for composite projections"
        },
        "clipAngle": {
          "type": "number",
          "minimum": 0,
          "maximum": 180,
          "description": "Clip angle in degrees"
        },
        "distance": {
          "type": "number",
          "minimum": 0,
          "description": "Distance parameter for satellite projection"
        },
        "tilt": {
          "type": "number",
          "description": "Tilt parameter for satellite projection"
        }
      },
      "additionalProperties": false
    },
    "projectionConfig": {
      "type": "object",
      "required": ["id", "parameters"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Projection ID from registry"
        },
        "parameters": {
          "$ref": "#/definitions/projectionParameters"
        }
      },
      "additionalProperties": false
    },
    "unifiedConfig": {
      "type": "object",
      "required": ["projection"],
      "properties": {
        "projection": {
          "$ref": "#/definitions/projectionConfig"
        }
      },
      "additionalProperties": false
    },
    "splitConfig": {
      "type": "object",
      "required": ["mainland", "territories"],
      "properties": {
        "mainland": {
          "type": "object",
          "required": ["projection"],
          "properties": {
            "projection": {
              "$ref": "#/definitions/projectionConfig"
            }
          },
          "additionalProperties": false
        },
        "territories": {
          "type": "object",
          "description": "Per-territory projections keyed by territory code",
          "additionalProperties": {
            "type": "object",
            "required": ["projection"],
            "properties": {
              "projection": {
                "$ref": "#/definitions/projectionConfig"
              }
            },
            "additionalProperties": false
          }
        }
      },
      "additionalProperties": false
    },
    "compositeExistingConfig": {
      "type": "object",
      "required": ["projectionId"],
      "properties": {
        "projectionId": {
          "type": "string",
          "description": "D3 composite projection ID (e.g., 'conic-conformal-france')"
        },
        "globalScale": {
          "type": "number",
          "minimum": 0.1,
          "maximum": 10,
          "default": 1.0,
          "description": "Optional global scale multiplier"
        }
      },
      "additionalProperties": false
    }
  }
}

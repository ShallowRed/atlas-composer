{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Geographic Atlas Configuration",
  "description": "Unified configuration for geographic atlases including territories, projections, and UI settings",
  "type": "object",
  "required": ["id", "name", "territories"],
  "properties": {
    "$schema": {
      "type": "string",
      "description": "JSON Schema reference"
    },
    "id": {
      "type": "string",
      "description": "Unique identifier for the atlas (e.g., 'portugal', 'france', 'eu')",
      "pattern": "^[a-z][a-z0-9-]*$"
    },
    "name": {
      "oneOf": [
        { "type": "string" },
        {
          "type": "object",
          "properties": {
            "en": { "type": "string" },
            "fr": { "type": "string" }
          },
          "required": ["en"]
        }
      ],
      "description": "Human-readable name (string or i18n object)"
    },
    "description": {
      "oneOf": [
        { "type": "string" },
        {
          "type": "object",
          "properties": {
            "en": { "type": "string" },
            "fr": { "type": "string" }
          },
          "required": ["en"]
        }
      ],
      "description": "Brief description of the atlas (string or i18n object)"
    },
    "dataSources": {
      "type": "object",
      "description": "Data source files for territories and metadata",
      "properties": {
        "territories": {
          "type": "string",
          "description": "Path to the GeoJSON file containing territory geometries",
          "examples": ["world-countries-110m.json", "france-regions-50m.json"]
        },
        "metadata": {
          "type": "string",
          "description": "Path to the JSON file containing territory metadata",
          "examples": ["world-metadata-110m.json", "france-metadata-50m.json"]
        }
      },
      "required": ["territories", "metadata"]
    },
    "pattern": {
      "type": "string",
      "enum": ["single-focus", "equal-members", "hierarchical"],
      "description": "Atlas pattern type: 'single-focus' for traditional atlases with one primary territory (mainland) and secondary territories (overseas), 'equal-members' for atlases where all territories are equal (EU, world), 'hierarchical' for complex multi-level structures (future)"
    },
    "viewModes": {
      "type": "array",
      "description": "Supported view modes for this atlas. Defaults to all modes if not specified.",
      "items": {
        "type": "string",
        "enum": ["split", "composite-existing", "composite-custom", "unified"]
      },
      "uniqueItems": true,
      "examples": [
        ["composite-existing", "unified"],
        ["split", "composite-existing", "composite-custom", "unified"]
      ]
    },
    "defaultViewMode": {
      "type": "string",
      "description": "Default view mode for this atlas. Defaults to 'composite-custom' if not specified.",
      "enum": ["split", "composite-existing", "composite-custom", "unified"]
    },
    "mapDisplayDefaults": {
      "type": "object",
      "description": "Default display options applied to maps when loading this atlas.",
      "properties": {
        "showGraticule": {
          "type": "boolean",
          "description": "Display latitude/longitude graticule overlay.",
          "default": false
        },
        "showCompositionBorders": {
          "type": "boolean",
          "description": "Display composition borders for composite projections when available.",
          "default": false
        },
        "showMapLimits": {
          "type": "boolean",
          "description": "Display the bounding box outlining the map extent.",
          "default": false
        }
      },
      "additionalProperties": false
    },
    "compositeProjections": {
      "type": "array",
      "description": "List of composite projection IDs available for this atlas in composite-existing mode. If not specified, defaults to 'conic-conformal-{atlasId}'.",
      "items": {
        "type": "string"
      },
      "examples": [
        ["albers-usa", "albers-usa-composite", "albers-usa-territories"],
        ["conic-conformal-france"]
      ]
    },
    "defaultCompositeProjection": {
      "type": "string",
      "description": "Default composite projection ID to use in composite-existing mode. If not specified, uses the first projection from compositeProjections array.",
      "examples": ["albers-usa", "conic-conformal-france"]
    },
    "metadata": {
      "type": "object",
      "properties": {
        "naturalEarthIds": {
          "type": "array",
          "items": { "type": "integer" },
          "description": "Natural Earth feature IDs"
        },
        "iso3": {
          "type": "string",
          "pattern": "^[A-Z]{3}$",
          "description": "ISO 3166-1 alpha-3 country code"
        },
        "region": {
          "type": "string",
          "description": "Geographic region (e.g., 'Europe', 'Asia')"
        }
      }
    },
    "projection": {
      "type": "object",
      "description": "Projection parameters",
      "properties": {
        "center": {
          "type": "object",
          "properties": {
            "longitude": { "type": "number", "minimum": -180, "maximum": 180 },
            "latitude": { "type": "number", "minimum": -90, "maximum": 90 }
          },
          "required": ["longitude", "latitude"]
        },
        "rotate": {
          "type": "object",
          "properties": {
            "mainland": {
              "type": "array",
              "items": { "type": "number" },
              "minItems": 2,
              "maxItems": 3
            },
            "azimuthal": {
              "type": "array",
              "items": { "type": "number" },
              "minItems": 2,
              "maxItems": 3
            }
          }
        },
        "parallels": {
          "type": "object",
          "properties": {
            "conic": {
              "type": "array",
              "items": { "type": "number" },
              "minItems": 2,
              "maxItems": 2
            }
          }
        }
      }
    },
    "projectionPreferences": {
      "type": "object",
      "description": "Projection preferences and recommendations for this atlas",
      "properties": {
        "recommended": {
          "type": "array",
          "description": "Array of recommended projection IDs for this atlas",
          "items": {
            "type": "string"
          },
          "examples": [["conic-conformal", "albers", "mercator"]]
        },
        "default": {
          "type": "object",
          "description": "Default projections for different territory types",
          "properties": {
            "mainland": {
              "type": "string",
              "description": "Default projection ID for mainland territory",
              "examples": ["conic-conformal", "albers"]
            },
            "overseas": {
              "type": "string",
              "description": "Default projection ID for overseas territories",
              "examples": ["mercator", "azimuthal-equal-area"]
            }
          }
        },
        "prohibited": {
          "type": "array",
          "description": "Array of projection IDs that are not suitable for this atlas",
          "items": {
            "type": "string"
          },
          "examples": [["gnomonic", "polyhedral-waterman"]]
        }
      }
    },
    "territories": {
      "oneOf": [
        {
          "type": "string",
          "enum": ["*"],
          "description": "Use '*' to load all territories from data file (for equal-members patterns like world atlas)"
        },
        {
          "type": "array",
          "description": "List of territories",
          "minItems": 1,
          "items": {
            "type": "object",
            "required": ["id", "code", "name", "role"],
            "properties": {
              "id": {
                "type": "string",
                "description": "Natural Earth ID or compound ID (e.g., '620', '620-20')"
              },
              "code": {
                "type": "string",
                "description": "Territory code (e.g., 'PT-CONT', 'PT-20', 'FR', 'DE')",
                "pattern": "^[A-Z]{2}(-[A-Z0-9-]+)?$"
              },
              "name": {
                "type": "string",
                "description": "Territory name"
              },
              "role": {
                "type": "string",
                "enum": ["primary", "secondary", "member", "embedded"],
                "description": "Territory role in the atlas. Use 'primary' for single-focus primary territory (mainland), 'member' for equal-members territories (EU member states, all world countries), 'secondary' for remote territories (overseas, islands), 'embedded' for enclaves/exclaves"
              },
              "iso": {
                "type": "string",
                "pattern": "^[A-Z]{3}$",
                "description": "ISO 3166-1 alpha-3 code"
              },
              "region": {
                "type": "string",
                "description": "Geographic sub-region (e.g., 'Atlantic', 'Indian Ocean')"
              },
              "bounds": {
                "type": "array",
                "description": "Bounding box [[minLon, minLat], [maxLon, maxLat]]",
                "items": {
                  "type": "array",
                  "items": { "type": "number" },
                  "minItems": 2,
                  "maxItems": 2
                },
                "minItems": 2,
                "maxItems": 2
              },
              "center": {
                "type": "array",
                "description": "Geographic center [longitude, latitude]",
                "items": { "type": "number" },
                "minItems": 2,
                "maxItems": 2
              },
              "extraction": {
                "type": "object",
                "description": "How to extract this territory from Natural Earth data",
                "properties": {
                  "extractFrom": {
                    "type": "string",
                    "description": "Parent territory ID to extract from"
                  },
                  "mainlandPolygon": {
                    "type": "integer",
                    "description": "Index of the mainland polygon in MultiPolygon",
                    "minimum": 0
                  },
                  "polygonIndices": {
                    "type": "array",
                    "description": "Indices of polygons to extract",
                    "items": { "type": "integer", "minimum": 0 },
                    "minItems": 1
                  }
                }
              },
              "rendering": {
                "type": "object",
                "description": "Rendering configuration for frontend",
                "properties": {
                  "offset": {
                    "type": "array",
                    "description": "Translation offset [x, y]",
                    "items": { "type": "number" },
                    "minItems": 2,
                    "maxItems": 2
                  },
                  "projectionType": {
                    "type": "string",
                    "enum": [
                      "mercator",
                      "transverse-mercator",
                      "equirectangular",
                      "miller",
                      "albers",
                      "conic-conformal",
                      "conic-equal-area",
                      "conic-equidistant",
                      "azimuthal-equal-area",
                      "azimuthal-equidistant",
                      "orthographic",
                      "stereographic",
                      "gnomonic",
                      "equal-earth",
                      "mollweide",
                      "sinusoidal",
                      "robinson",
                      "winkel3",
                      "bonne",
                      "aitoff",
                      "hammer",
                      "bertin1953",
                      "polyhedral-waterman"
                    ],
                    "description": "Specific projection type for this territory (must match projection service options)"
                  },
                  "scale": {
                    "type": "number",
                    "description": "Scale factor",
                    "minimum": 0
                  }
                }
              }
            }
          }
        }
      ]
    },
    "modes": {
      "type": "array",
      "description": "UI modes for selecting territory combinations (legacy, use territoryModes instead)",
      "items": {
        "type": "object",
        "required": ["id", "label", "territories"],
        "properties": {
          "id": {
            "type": "string",
            "description": "Mode identifier",
            "pattern": "^[a-z][a-z0-9-]*$"
          },
          "label": {
            "type": "string",
            "description": "UI label"
          },
          "territories": {
            "type": "array",
            "description": "Territory codes included in this mode",
            "items": { "type": "string" },
            "minItems": 1
          }
        }
      }
    },
    "territoryModes": {
      "type": "array",
      "description": "UI modes for selecting territory combinations (replaces modes)",
      "items": {
        "type": "object",
        "required": ["id", "name", "territoryCodes"],
        "properties": {
          "id": {
            "type": "string",
            "description": "Mode identifier",
            "pattern": "^[a-z][a-z0-9-]*$"
          },
          "name": {
            "oneOf": [
              { "type": "string" },
              {
                "type": "object",
                "properties": {
                  "en": { "type": "string" },
                  "fr": { "type": "string" }
                },
                "required": ["en"]
              }
            ],
            "description": "UI label (string or i18n object)"
          },
          "territoryCodes": {
            "oneOf": [
              {
                "type": "string",
                "enum": ["*"],
                "description": "Use '*' to include all territories"
              },
              {
                "type": "array",
                "description": "Territory codes included in this mode",
                "items": { "type": "string" },
                "minItems": 1
              }
            ]
          },
          "exclude": {
            "type": "array",
            "description": "Territory codes to exclude when using '*' for all territories",
            "items": { "type": "string" }
          }
        }
      }
    },
    "defaultTerritoryMode": {
      "type": "string",
      "description": "Default territory mode ID to use on initial load",
      "pattern": "^[a-z][a-z0-9-]*$"
    },
    "defaultProjection": {
      "type": "string",
      "description": "Default projection ID for this atlas (e.g., 'naturalEarth1', 'robinson')"
    },
    "groups": {
      "type": "array",
      "description": "UI groupings for territories",
      "items": {
        "type": "object",
        "required": ["id", "label", "territories"],
        "properties": {
          "id": {
            "type": "string",
            "description": "Group identifier",
            "pattern": "^[a-z][a-z0-9-]*$"
          },
          "label": {
            "type": "string",
            "description": "UI label"
          },
          "territories": {
            "type": "array",
            "description": "Territory codes in this group",
            "items": { "type": "string" },
            "minItems": 1
          }
        }
      }
    }
  }
}

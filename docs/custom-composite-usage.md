# Guide d'Utilisation - Projection Composite Personnalis√©e

## Introduction

Le mode **Projection composite personnalis√©e** permet de cr√©er des cartes o√π chaque territoire (France m√©tropolitaine et DOM-TOM) peut avoir :
- Sa propre projection g√©ographique
- Son propre positionnement sur la carte
- Sa propre √©chelle

## Activation

1. S√©lectionner **Mode d'affichage** : `Projection composite personnalis√©e`
2. Activer **Mode de projection** : `Individual` (projections par territoire)

## Interface

### Contr√¥les Principaux

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Configuration                                        ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ Theme                           [üåô Dark]           ‚îÇ
‚îÇ Mode d'affichage               [Composite custom]   ‚îÇ
‚îÇ Mode de projection             [Individual]         ‚îÇ
‚îÇ Projection globale             [Albers France]      ‚îÇ
‚îÇ Territoires affich√©s           [Tous]               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Param√®tres par Territoire

Chaque territoire dispose d'un panneau accord√©on :

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ‚ñº Guadeloupe (FR-GP)                                ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ Projection              [Mercator            ‚ñº]     ‚îÇ
‚îÇ Translation X           [‚îÅ‚îÅ‚îÅ‚óè‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ] -400          ‚îÇ
‚îÇ Translation Y           [‚îÅ‚îÅ‚îÅ‚óè‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ] 100           ‚îÇ
‚îÇ √âchelle                 [‚îÅ‚îÅ‚îÅ‚óè‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ] 1.0           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## Types de Projections Disponibles

| Projection | Usage Recommand√© | D√©formation |
|------------|-----------------|-------------|
| **Mercator** | Zones tropicales (DOM-TOM) | Pr√©serve les angles, d√©forme les surfaces |
| **Conic Conformal** | Zones temp√©r√©es (FR-MET) | Bonne pour latitudes moyennes |
| **Albers Equal Area** | Analyses statistiques | Pr√©serve les surfaces |
| **Azimuthal Equidistant** | Territoires insulaires | Distances correctes depuis le centre |

## Flux de Travail

### 1. Mode Uniform (Par D√©faut)

Tous les territoires utilisent la m√™me projection :

```typescript
// Exemple: Tous en Mercator
configStore.projectionMode = 'uniform'
configStore.selectedProjection = 'mercator'
```

**Avantage** : Coh√©rence visuelle
**Inconv√©nient** : D√©formations identiques partout

### 2. Mode Individual (Avanc√©)

Chaque territoire a sa propre projection :

```typescript
// Exemple: FR-MET en Conic Conformal, DOM-TOM en Mercator
configStore.projectionMode = 'individual'
configStore.territoryProjections = {
  'FR-MET': 'conic-conformal',
  'FR-GP': 'mercator',
  'FR-MQ': 'mercator',
  // ...
}
```

**Avantage** : Projections optimis√©es par territoire
**Inconv√©nient** : N√©cessite ajustements manuels

## Exemples de Configuration

### Configuration Standard (Recommand√©e)

```json
{
  "viewMode": "composite-custom",
  "projectionMode": "individual",
  "territoryProjections": {
    "FR-MET": "conic-conformal",
    "FR-GP": "mercator",
    "FR-MQ": "mercator",
    "FR-GF": "mercator",
    "FR-RE": "mercator",
    "FR-YT": "mercator",
    "FR-NC": "mercator",
    "FR-PF": "mercator",
    "FR-MF": "mercator",
    "FR-WF": "mercator",
    "FR-PM": "mercator"
  }
}
```

### Configuration Exp√©rimentale (Azimuthale pour Polyn√©sie)

```json
{
  "viewMode": "composite-custom",
  "projectionMode": "individual",
  "territoryProjections": {
    "FR-MET": "conic-conformal",
    "FR-PF": "azimuthal-equidistant",
    "FR-NC": "azimuthal-equidistant"
  }
}
```

## Ajustement des Translations

### Comprendre les Axes

```
        Y n√©gatif (haut)
              ‚Üë
              |
‚Üê‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí X n√©gatif   X positif
   (gauche)   |   (droite)
              |
              ‚Üì
        Y positif (bas)
```

### Positionnement Typique

| Territoire | Translation X | Translation Y | Rationale |
|-----------|---------------|---------------|-----------|
| FR-MET | 0 | 0 | Centre de r√©f√©rence |
| FR-GP | -400 | 100 | En bas √† gauche |
| FR-MQ | -400 | 200 | Sous la Guadeloupe |
| FR-GF | -400 | 300 | Sous la Martinique |
| FR-RE | 300 | 100 | En bas √† droite |
| FR-YT | 350 | 200 | √Ä c√¥t√© de La R√©union |
| FR-NC | 450 | -100 | En haut √† droite |
| FR-PF | 450 | 100 | Sous Nouvelle-Cal√©donie |
| FR-PM | -100 | -200 | En haut √† gauche |
| FR-WF | 400 | 250 | Entre RE et PF |
| FR-MF | -350 | 80 | Pr√®s de GP |

## Ajustement des √âchelles

### R√®gles G√©n√©rales

- **√âchelle 1.0** : Taille par d√©faut
- **√âchelle > 1.0** : Agrandir (ex: 1.5 = 150%)
- **√âchelle < 1.0** : R√©duire (ex: 0.8 = 80%)

### Exemples Pratiques

```typescript
// Mettre en √©vidence La R√©union
cartographer.updateTerritoryScale('FR-RE', 1.3)

// R√©duire la Polyn√©sie pour √©conomiser de l'espace
cartographer.updateTerritoryScale('FR-PF', 0.7)

// Grossir les petites √Æles pour la lisibilit√©
cartographer.updateTerritoryScale('FR-MF', 1.5)
cartographer.updateTerritoryScale('FR-WF', 1.5)
```

## Cas d'Usage

### Carte pour Analyse Statistique

**Objectif** : Pr√©server les surfaces pour comparer visuellement les densit√©s

```typescript
configStore.projectionMode = 'uniform'
configStore.selectedProjection = 'albers'
```

### Carte pour Navigation

**Objectif** : Pr√©server les angles pour la navigation maritime

```typescript
configStore.projectionMode = 'uniform'
configStore.selectedProjection = 'mercator'
```

### Carte Optimis√©e par Territoire

**Objectif** : Minimiser les d√©formations pour chaque zone

```typescript
configStore.projectionMode = 'individual'
// FR-MET: Conic Conformal (optimal pour latitudes 45-50¬∞N)
configStore.territoryProjections['FR-MET'] = 'conic-conformal'

// DOM-TOM tropicaux: Mercator (optimal pour √©quateur)
  ['FR-GP', 'FR-MQ', 'FR-GF'].forEach((code) => {
    configStore.territoryProjections[code] = 'mercator'
  })

// √éles du Pacifique: Azimuthale (optimal pour √Æles isol√©es)
  ['FR-NC', 'FR-PF', 'FR-WF'].forEach((code) => {
    configStore.territoryProjections[code] = 'azimuthal-equidistant'
  })
```

## Export de Configuration

### Exporter la Configuration Actuelle

```typescript
const config = geoDataStore.cartographer.exportCustomCompositeConfig()
console.log(JSON.stringify(config, null, 2))
```

### Format d'Export

```json
{
  "subProjections": [
    {
      "territoryCode": "FR-MET",
      "territoryName": "France M√©tropolitaine",
      "projectionType": "ConicConformal",
      "center": [2.5, 46.5],
      "scale": 2800,
      "rotate": [-3, 0],
      "translateOffset": [0, 0],
      "bounds": [[-5, 41], [10, 51]]
    },
    {
      "territoryCode": "FR-GP",
      "territoryName": "Guadeloupe",
      "projectionType": "Mercator",
      "center": [-61.551, 16.265],
      "scale": 18000,
      "translateOffset": [-400, 100],
      "bounds": [[-61.81, 15.83], [-61.0, 16.52]]
    }
  ]
}
```

### R√©importer une Configuration

```typescript
// TODO: Feature √† impl√©menter
// configStore.importCustomCompositeConfig(savedConfig)
```

## D√©bogage

### Visualiser les Fronti√®res de Composition

```typescript
const borders = geoDataStore.cartographer.getCompositionBorders(800, 600)
console.log('Territory inset borders:', borders)

// Exemple de sortie:
// [
//   {
//     territoryCode: 'FR-GP',
//     territoryName: 'Guadeloupe',
//     bounds: [[150, 250], [250, 350]] // Top-left, bottom-right
//   }
// ]
```

### V√©rifier la Configuration Active

```typescript
console.log('View mode:', configStore.viewMode)
console.log('Projection mode:', configStore.projectionMode)
console.log('Territory projections:', configStore.territoryProjections)
```

### Probl√®mes Courants

| Sympt√¥me | Cause Possible | Solution |
|----------|----------------|----------|
| Territoire invisible | Hors du canvas | Ajuster translateOffset |
| Territoire d√©form√© | Mauvaise projection | Choisir projection adapt√©e |
| Territoire trop petit | √âchelle trop faible | Augmenter scale |
| Chevauchement | Translations proches | Espacer les territoires |

## Performance

### Recommandations

- **Nombre de Territoires** : ‚â§ 15 pour performances optimales
- **Mise √† Jour** : Batch les modifications avant de re-render
- **√âchelles** : √âviter les valeurs extr√™mes (< 0.5 ou > 3.0)

### Mesure des Performances

```typescript
console.time('render-custom-composite')
await geoDataStore.renderCustomComposite(container)
console.timeEnd('render-custom-composite')
```

## Limitations

1. **Pas de Graticule Unifi√©** : Chaque territoire a sa propre grille lat/lon
2. **Transitions Brutales** : Pas de blend entre les projections aux fronti√®res
3. **Sphere Non Support√©e** : Les m√©thodes globales (`.sphere()`) n'ont pas de sens
4. **Ordre des Tests** : Le premier territoire qui matche gagne (peut causer des ambigu√Øt√©s)

## R√©f√©rences

- [Documentation Technique](./custom-composite-projection.md)
- [Code Source](../src/services/CustomCompositeProjection.ts)
- [D3 Geo Projections](https://github.com/d3/d3-geo)

# Changelog - Cartographie de la France

## 2025-10-04 - Optimisations et am√©liorations majeures

### üéØ Centralisation des constantes de territoires
- **Nouveau fichier**: `src/constants/territories.ts`
- Toutes les configurations de territoires (codes, noms, coordonn√©es, scales, offsets, bounds) sont maintenant centralis√©es
- Ajout de fonctions utilitaires: `getTerritoryConfig()`, `getTerritoryName()`, `getTerritoryShortName()`
- Groupements de territoires par r√©gion (Cara√Øbes, Oc√©an Indien, Pacifique, etc.)
- Liste compl√®te: `TERRITORY_CODES`, `ALL_TERRITORIES`, `TERRITORIES_BY_CODE`

### üó∫Ô∏è Am√©lioration du positionnement des DOM-TOM
Nouveaux placements optimis√©s pour une meilleure lisibilit√©:

**Cara√Øbes (gauche)**:
- Saint-Barth√©lemy: (-450, -150) - En haut
- Saint-Martin: (-450, -50)
- Guadeloupe: (-450, 50)
- Martinique: (-450, 150)
- Guyane: (-450, 280) - En bas (plus grand)

**Atlantique Nord**:
- Saint-Pierre-et-Miquelon: (-200, -200)

**Oc√©an Indien (droite)**:
- Mayotte: (350, -50) - En haut (petite √Æle)
- La R√©union: (350, 50)
- TAAF: (350, 250) - En bas (grand territoire)

**Pacifique (extr√™me droite)**:
- Nouvelle-Cal√©donie: (550, -100) - En haut
- Wallis-et-Futuna: (550, 50) - Petites √Æles
- Polyn√©sie fran√ßaise: (550, 180) - En bas (grand territoire)

### üîß Correction du bug d'accumulation de scale
- **Probl√®me**: Scaler √† 1.5x puis revenir √† 1.0x laissait le territoire plus grand
- **Solution**: Ajout de `scaleMultiplier` dans `SubProjectionConfig`
- Le `baseScale` est maintenant toujours extrait correctement: `baseScale = currentScale / scaleMultiplier`
- Lors du changement de type de projection, le multiplier est pr√©serv√©

### üé® Am√©lioration de l'UI
- **Mode de projection**: Chang√© de boutons √† dropdown (plus compact et coh√©rent)
- **Mode uniform**: Fonctionne maintenant correctement - applique la projection s√©lectionn√©e √† TOUS les territoires
- Utilisation des constantes centralis√©es pour initialiser les translations et scales

### üßπ Nettoyage du code
Suppression de tous les logs de debug ajout√©s pendant l'investigation:
- `CustomCompositeProjection.ts`: Supprim√© 10+ console.log
- `Cartographer.ts`: Supprim√© logs d'initialisation et de build
- `geoData.ts`: Supprim√© logs de synchronisation
- `config.ts`: Supprim√© logs de setters
- `MapRenderer.vue`: Supprim√© logs de watch
- `TerritoryControls.vue`: Supprim√© logs d'√©v√©nements
- `GeoDataService.ts`: Supprim√© logs de chargement
- Conserv√© uniquement les logs d'erreur critiques

### üìä Architecture am√©lior√©e
**Avant**:
```typescript
// Donn√©es en dur dispers√©es dans multiple fichiers
const domtomDefaults = [
  { code: 'FR-GP', name: 'Guadeloupe', center: [-61.551, 16.265], ... },
  // ... r√©p√©t√© dans CustomCompositeProjection.ts
]

const territoryTranslations = {
  'FR-GP': { x: -400, y: 100 },
  // ... r√©p√©t√© dans config.ts
}
```

**Apr√®s**:
```typescript
// Source unique de v√©rit√©
import { ALL_TERRITORIES, MAINLAND_FRANCE } from '../constants/territories'

// Initialisation automatique
const territoryTranslations = Object.fromEntries(
  ALL_TERRITORIES.map(t => [t.code, { x: t.offset[0], y: t.offset[1] }])
)
```

### üöÄ B√©n√©fices
1. **Maintenabilit√©**: Une seule source de v√©rit√© pour les donn√©es de territoires
2. **Coh√©rence**: Impossible d'avoir des donn√©es d√©synchronis√©es entre fichiers
3. **Lisibilit√©**: Code plus propre sans logs de debug partout
4. **Performance**: Pas de calculs inutiles ou de logs en production
5. **Extensibilit√©**: Facile d'ajouter de nouveaux territoires ou groupements

### üêõ Bugs corrig√©s
- ‚úÖ Accumulation de scale lors des changements de projection
- ‚úÖ Mode "Uniform" qui n'appliquait pas la projection √† tous les territoires
- ‚úÖ Donn√©es de territoires dupliqu√©es et d√©synchronis√©es

### üìù Fichiers modifi√©s
- `src/constants/territories.ts` (nouveau)
- `src/services/CustomCompositeProjection.ts`
- `src/stores/config.ts`
- `src/stores/geoData.ts`
- `src/cartographer/Cartographer.ts`
- `src/services/GeoDataService.ts`
- `src/components/TerritoryControls.vue`
- `src/components/MapRenderer.vue`
- `src/components/DOMTOMGrid.vue`
- `src/App.vue`

---

## Anciennes versions

### 2025-10-03 - Fix de la projection composite personnalis√©e
- Impl√©mentation du pattern albersUsa avec multiplex stream
- Ajout des clip extents pour isoler les territoires
- Fix du bug de translation offset doubling
- Centrage de la France m√©tropolitaine

### 2025-10-02 - Initialisation du projet
- Configuration Vite + TypeScript + Vue 3
- Observable Plot pour le rendu cartographique
- D3-geo pour les projections
- Architecture modulaire avec stores Pinia
